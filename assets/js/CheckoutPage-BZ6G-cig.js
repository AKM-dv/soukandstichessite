import{a as e,r as s,j as t,B as r,aI as o,I as n,aA as i,T as a,aJ as l,aK as c,P as d,g as x,e as f,aE as m,aG as h,V as u,i as p,aL as g,F as j,aM as y,aN as b,aO as v,aP as S,f as z,h as W,aQ as _,w as C,a9 as I,A as w}from"./mui-BsZk_SdY.js";import{R,d as k,u as N,a as O}from"./index-CKIR3VUY.js";import{u as E}from"./router-BqjGcK6Z.js";import"./vendor-HnKmhvXM.js";import"./utils-D-l9lzRM.js";const P="checkout_form_data",$=()=>{const $=E(),F=k();e("(max-width:768px)");const{cartItems:A,getCartTotal:M,isLoggedIn:q,customerData:D,updateCartItem:T,removeFromCart:L}=N(),U=e=>{try{localStorage.setItem(P,JSON.stringify(e))}catch(s){}},K=()=>{try{const e=localStorage.getItem(P);return e?JSON.parse(e):null}catch(e){return null}},H=()=>{try{localStorage.removeItem(P)}catch(e){}},[B,J]=s.useState(!1),[Y,Q]=s.useState({open:!1,message:"",severity:"success"}),[Z,G]=s.useState({firstName:"",lastName:"",country:"India",address1:"",address2:"",city:"",state:"",pincode:"",phone:"",email:""}),[V,X]=s.useState("online"),[ee,se]=s.useState(!1),[te,re]=s.useState({subtotal:0,shipping:0,tax:0,total:0}),[oe,ne]=s.useState(600);s.useEffect(()=>{ie()},[A]),s.useEffect(()=>{const e=K();e&&(G(s=>({...s,...e})),e.paymentMethod&&X(e.paymentMethod),void 0!==e.termsAccepted&&se(e.termsAccepted))},[]),s.useEffect(()=>{D&&q&&G(e=>({...e,firstName:D.firstName||e.firstName,lastName:D.lastName||e.lastName,email:D.email||e.email,phone:D.phone||e.phone}))},[D,q]),s.useEffect(()=>{q||H()},[q]),s.useEffect(()=>{const e=setInterval(()=>{ne(s=>s<=1?(clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)},[]);const ie=()=>{const e=M();re({subtotal:e,shipping:0,tax:0,total:e+0+0})},ae=e=>{const{name:s,value:t,type:r,checked:o}=e.target,n={...Z,[s]:"checkbox"===r?o:t};G(n),U(n)};return t.jsxs(r,{sx:{minHeight:"100vh",bgcolor:"#f8f9fa",py:4},children:[t.jsxs(o,{maxWidth:"xl",children:[t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2,mb:4},children:[t.jsx(n,{onClick:()=>$("/"),sx:{bgcolor:"#ffffff",boxShadow:"0 2px 8px rgba(0,0,0,0.1)","&:hover":{bgcolor:"#f5f5f5"}},children:t.jsx(i,{})}),t.jsx(a,{variant:"h4",sx:{fontWeight:600,color:"#333",fontFamily:"Inter, sans-serif"},children:"Checkout"})]}),t.jsxs(r,{sx:{mb:4},children:[t.jsx(l,{variant:"determinate",value:75,sx:{height:6,borderRadius:3,bgcolor:"#e9ecef","& .MuiLinearProgress-bar":{borderRadius:3,bgcolor:"#e74c3c"}}}),t.jsx(a,{sx:{mt:1,fontSize:"0.9rem",color:"#666",textAlign:"center"},children:"Shipping and Checkout"})]}),oe>0&&t.jsx(r,{sx:{bgcolor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:2,p:2,mb:4,textAlign:"center"},children:t.jsxs(a,{sx:{color:"#856404",fontWeight:600,fontSize:"0.95rem"},children:["Your order is reserved for: ",(le=oe,`${Math.floor(le/60)}:${(le%60).toString().padStart(2,"0")}`)]})}),t.jsxs(c,{container:!0,spacing:4,sx:{display:"flex",flexWrap:"wrap"},children:[t.jsx(c,{item:!0,xs:12,sm:12,md:8,lg:8,sx:{display:"flex",flexDirection:"column"},children:t.jsxs(d,{sx:{p:4,borderRadius:2},children:[!q&&t.jsx(r,{sx:{mb:3,textAlign:"center"},children:t.jsxs(a,{sx:{color:"#666",fontSize:"0.9rem"},children:["Returning customer?",t.jsx(x,{variant:"text",sx:{ml:1,p:0,minWidth:"auto",textTransform:"none",color:"#e74c3c",fontWeight:600},children:"Click here to login"})]})}),t.jsx(a,{variant:"h5",sx:{fontWeight:600,color:"#333",mb:3,fontFamily:"Inter, sans-serif"},children:"Billing details"}),t.jsxs(r,{sx:{display:"flex",flexDirection:"column",gap:3},children:[t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["First name ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"firstName",value:Z.firstName,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Last name ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"lastName",value:Z.lastName,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Country / Region ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(m,{fullWidth:!0,size:"small",children:t.jsxs(h,{name:"country",value:Z.country,onChange:ae,sx:{borderRadius:1,bgcolor:"#ffffff"},children:[t.jsx(u,{value:"India",children:"India"}),t.jsx(u,{value:"United States",children:"United States (US)"}),t.jsx(u,{value:"United Kingdom",children:"United Kingdom (UK)"}),t.jsx(u,{value:"Canada",children:"Canada"}),t.jsx(u,{value:"Australia",children:"Australia"})]})})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Street address ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"address1",value:Z.address1,onChange:ae,required:!0,variant:"outlined",size:"small",placeholder:"House number and street name",sx:{mb:2,"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}}),t.jsx(f,{fullWidth:!0,name:"address2",value:Z.address2,onChange:ae,variant:"outlined",size:"small",placeholder:"Apartment, suite, unit, etc. (optional)",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Town / City ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"city",value:Z.city,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["State ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"state",value:Z.state,onChange:ae,required:!0,variant:"outlined",size:"small",placeholder:"Enter your state",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["ZIP Code ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"pincode",value:Z.pincode,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Phone ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"phone",value:Z.phone,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]}),t.jsxs(r,{children:[t.jsxs(a,{sx:{mb:1,fontWeight:500,color:"#333",fontSize:"0.9rem"},children:["Email address ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]}),t.jsx(f,{fullWidth:!0,name:"email",type:"email",value:Z.email,onChange:ae,required:!0,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:1,bgcolor:"#ffffff"}}})]})]})]})}),t.jsx(c,{item:!0,xs:12,sm:12,md:4,lg:4,sx:{display:"flex",flexDirection:"column"},children:t.jsxs(d,{sx:{p:4,borderRadius:2,position:"sticky",top:20,bgcolor:"#ffffff"},children:[t.jsx(a,{variant:"h5",sx:{fontWeight:600,color:"#333",mb:3,fontFamily:"Inter, sans-serif"},children:"Your order"}),t.jsx(r,{sx:{mb:3},children:A.map(e=>t.jsxs(r,{sx:{display:"flex",gap:2,mb:2,pb:2,borderBottom:"1px solid #eee"},children:[t.jsx(r,{sx:{width:50,height:50,borderRadius:1,overflow:"hidden",flexShrink:0,bgcolor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center"},children:(()=>{const s=e.image_url||e.image||`https://soukandstiches.mycartly.in/uploads/products/1532365/${e.product_id}_v1.png`;return t.jsx("img",{src:s,alt:e.product_name||e.name,style:{width:"100%",height:"100%",objectFit:"cover"},onError:s=>{s.target.src.includes("_v1.png")?s.target.src.includes("_v2.png")?s.target.style.display="none":s.target.src=`https://soukandstiches.mycartly.in/uploads/products/1532365/${e.product_id}_v2.png`:s.target.src=`https://soukandstiches.mycartly.in/uploads/products/1532365/${e.product_id}_v1.png`}})})()}),t.jsxs(r,{sx:{flex:1},children:[t.jsx(a,{sx:{fontSize:"0.9rem",fontWeight:500,color:"#333",mb:.5},children:e.product_name||e.name}),e.variants&&Object.keys(e.variants).length>0&&t.jsx(a,{sx:{fontSize:"0.75rem",color:"#666",mb:.5},children:Object.entries(e.variants).map(([e,s])=>t.jsxs("span",{style:{marginRight:"8px"},children:[t.jsxs("strong",{children:[e,":"]})," ",s]},e))}),(!e.variants||0===Object.keys(e.variants).length)&&e.selected_variants&&Object.keys(e.selected_variants).length>0&&t.jsx(a,{sx:{fontSize:"0.75rem",color:"#666",mb:.5},children:Object.entries(e.selected_variants).map(([e,s])=>t.jsxs("span",{style:{marginRight:"8px"},children:[t.jsxs("strong",{children:[e,":"]})," ",s]},e))}),t.jsxs(a,{sx:{fontSize:"0.8rem",color:"#666",mb:.5},children:["Qty: ",e.quantity]}),t.jsxs(a,{sx:{fontSize:"0.9rem",fontWeight:600,color:"#333"},children:["₹",(e.price*e.quantity).toLocaleString()]})]})]},e.id))}),t.jsx(p,{sx:{my:3}}),t.jsxs(r,{sx:{mb:3},children:[t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[t.jsx(a,{sx:{fontSize:"0.9rem",color:"#333"},children:"Subtotal"}),t.jsxs(a,{sx:{fontSize:"0.9rem",color:"#333"},children:["₹",te.subtotal.toLocaleString()]})]}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[t.jsx(a,{sx:{fontSize:"0.9rem",color:"#333"},children:"Shipping"}),t.jsx(a,{sx:{fontSize:"0.9rem",color:"#333"},children:0===te.shipping?"FREE":`₹${te.shipping}`})]}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[t.jsx(a,{sx:{fontSize:"0.9rem",color:"#333"},children:"Tax"}),t.jsxs(a,{sx:{fontSize:"0.9rem",color:"#333"},children:["₹",te.tax.toLocaleString()]})]}),t.jsx(p,{sx:{my:2}}),t.jsxs(r,{sx:{display:"flex",justifyContent:"space-between"},children:[t.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:"Total"}),t.jsxs(a,{variant:"h6",sx:{fontWeight:600,color:"#333"},children:["₹",te.total.toLocaleString()]})]})]}),t.jsx(a,{variant:"h6",sx:{fontWeight:600,color:"#333",mb:2},children:"Payment"}),t.jsx(m,{component:"fieldset",fullWidth:!0,children:t.jsx(g,{value:V,onChange:e=>{const s=e.target.value;X(s);const t=K()||{};U({...t,paymentMethod:s})},children:t.jsx(j,{value:"online",control:t.jsx(S,{sx:{color:"#e74c3c"}}),label:t.jsxs(r,{children:[t.jsx(a,{sx:{fontWeight:500},children:"Online Payment"}),t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:1,mt:.5,flexWrap:"wrap"},children:[t.jsx(a,{sx:{fontSize:"0.8rem",color:"#666"},children:"Pay securely with"}),t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.25,borderRadius:999,bgcolor:"rgba(47, 141, 70, 0.12)"},children:[t.jsx(y,{sx:{fontSize:18,color:"#2F8D46"}}),t.jsx(a,{sx:{fontSize:"0.75rem",color:"#2F8D46",fontWeight:600},children:"UPI"})]}),t.jsx(a,{sx:{fontSize:"0.8rem",color:"#666"},children:","}),t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.25,borderRadius:999,bgcolor:"rgba(26, 31, 113, 0.12)"},children:[t.jsx(b,{sx:{fontSize:18,color:"#1A73E8"}}),t.jsx(a,{sx:{fontSize:"0.75rem",color:"#1A1F71",fontWeight:600},children:"Cards"})]}),t.jsx(a,{sx:{fontSize:"0.8rem",color:"#666"},children:"or"}),t.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:.5,px:1,py:.25,borderRadius:999,bgcolor:"rgba(95, 37, 159, 0.12)"},children:[t.jsx(v,{sx:{fontSize:18,color:"#5F259F"}}),t.jsx(a,{sx:{fontSize:"0.75rem",color:"#5F259F",fontWeight:600},children:"Wallets"})]})]})]})})})}),t.jsx(r,{sx:{my:3},children:t.jsx(j,{control:t.jsx(z,{checked:ee,onChange:e=>{const s=e.target.checked;se(s);const t=K()||{};U({...t,termsAccepted:s})},sx:{color:"#e74c3c"}}),label:t.jsxs(a,{sx:{fontSize:"0.9rem"},children:["I have read and agree to the website"," ",t.jsx(x,{variant:"text",onClick:()=>F("/terms-and-conditions",{},{reloadOn:["/terms-and-conditions"],forceReload:!0}),sx:{p:0,minWidth:"auto",textTransform:"none",color:"#e74c3c",fontWeight:600,textDecoration:"underline"},children:"terms and conditions"})," ",t.jsx("span",{style:{color:"#e74c3c"},children:"*"})]})})}),t.jsx(x,{fullWidth:!0,variant:"contained",size:"large",onClick:async()=>{if((()=>{const e=["firstName","lastName","address1","city","state","pincode","phone","email"];for(let s of e)if(!Z[s].trim())return Q({open:!0,message:`Please fill in ${s.replace(/([A-Z])/g," $1").toLowerCase()}`,severity:"error"}),!1;return!!ee||(Q({open:!0,message:"Please accept the terms and conditions",severity:"error"}),!1)})()){J(!0);try{const s={customer_details:{firstName:Z.firstName,lastName:Z.lastName,email:Z.email,phone:Z.phone,address:`${Z.address1}${Z.address2?", "+Z.address2:""}, ${Z.city}, ${Z.state} ${Z.pincode}, ${Z.country}`},payment_method:V,items:A.map(e=>({product_id:e.product_id,quantity:e.quantity,price:e.price,selected_variants:e.selected_variants||{}}))};try{const e=await O.post("/order",{...s,payment_method:"razorpay"});if(!e.data.success)throw new Error(e.data.error||"Failed to create order");{const s=e.data.order_id,t={amount:te.total,customer_name:`${Z.firstName} ${Z.lastName}`,customer_email:Z.email,customer_phone:Z.phone,order_id:s,description:`Order #${s} - Souk and Stitch`},r=await(async e=>new Promise((s,t)=>{if(void 0===window.Razorpay)return void t(new Error("Razorpay SDK not loaded"));const r={key:R.key_id,amount:100*e.amount,currency:R.currency,name:R.name,description:e.description||R.description,handler:function(e){s({success:!0,payment_id:e.razorpay_payment_id,order_id:e.razorpay_order_id,signature:e.razorpay_signature})},prefill:{name:e.customer_name,email:e.customer_email,contact:e.customer_phone},notes:{order_id:e.order_id},theme:R.theme,modal:{ondismiss:function(){t(new Error("Payment cancelled by user"))}}};new window.Razorpay(r).open()}))(t);r.success&&(H(),$(`/order-success/${s}`))}}catch(e){if("Payment cancelled by user"!==e.message)throw e;Q({open:!0,message:"Payment was cancelled",severity:"warning"})}}catch(s){Q({open:!0,message:s.message||"Failed to place order",severity:"error"})}finally{J(!1)}}},disabled:B||!ee,startIcon:B?t.jsx(W,{size:20}):t.jsx(_,{}),sx:{bgcolor:"#28a745",color:"#ffffff",py:1.5,fontSize:"1rem",fontWeight:600,borderRadius:2,"&:hover":{bgcolor:"#218838"},"&:disabled":{bgcolor:"#e9ecef",color:"#6c757d"}},children:B?"Processing...":"Proceed to Pay"}),t.jsxs(r,{sx:{mt:3,display:"flex",flexWrap:"wrap",gap:1,justifyContent:"center"},children:[t.jsx(C,{label:"100% SECURE",size:"small",sx:{bgcolor:"#e8f5e8",color:"#28a745",fontWeight:600,fontSize:"0.7rem"}}),t.jsx(C,{label:"SSL ENCRYPTED",size:"small",sx:{bgcolor:"#e8f5e8",color:"#28a745",fontWeight:600,fontSize:"0.7rem"}}),t.jsx(C,{label:"TRUSTED",size:"small",sx:{bgcolor:"#e8f5e8",color:"#28a745",fontWeight:600,fontSize:"0.7rem"}})]}),t.jsxs(r,{sx:{mt:4,p:3,bgcolor:"#f8f9fa",borderRadius:2,textAlign:"center"},children:[t.jsx(a,{sx:{fontSize:"0.8rem",color:"#666",fontStyle:"italic",mb:1},children:'"The quality of the customer service and speed of delivery was just fantastic - I know I can count on Souk and Stitch every time!"'}),t.jsx(a,{sx:{fontSize:"0.75rem",color:"#999",fontWeight:500},children:"- Happy Customer"})]})]})})]})]}),t.jsx(I,{open:Y.open,autoHideDuration:6e3,onClose:()=>Q({...Y,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(w,{onClose:()=>Q({...Y,open:!1}),severity:Y.severity,sx:{width:"100%",borderRadius:2},children:Y.message})})]});var le};export{$ as default};
